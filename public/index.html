<!-- 
	Ejemplo de como trabajar con el webservice de la aplicación.
	Aquí esta una prueba de como se llamaría a un recurso mediante una url
 -->
<!DOCTYPE html>
<html>
<head>
	<title>Ejemplo de API</title>
</head>
<body>
	<div>
		<p>Para poder hacer un post request debes de pasar un campo llamado "_token" con el valor de dicho token</p>
		<p>_token: <span id="token">Obteniendo token...</span></p>
	</div>
	<hr>
	<div>
		<form id="form-entity">
			<label for="valor">Valor</label>
			<!-- Es muy importante que los forms tengan este campo -->
			<input id="formToken" type="hidden" name="_token" required>
			<input type="text" name="value" required>
			<input type="submit" name="crear" value="Crear entidad">
		</form>
	</div>
	<hr>
	<div>
		<table id="display-table">
			<caption>Entidades</caption>
			<tr>
				<th>ID</th>
				<th>Valor</th>
			</tr>
		</table>
	</div>
	<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			prepararForm();
			getEntities();
			getToken();
		});
		function prepararForm()
		{
			//Hay que evitar que el form refresque la página
			$("#form-entity").submit(function(e){
     			e.preventDefault();
				createEntity();
				return false;
			});
		}
		function createEntity()
		{
			//La siguiente ruta espera una petición con cierto nombre de parametros,
			//así que es importante el nombre de los inputs en el form
			//nota: empezar las rutas con '/' para evitar problemas de routeo
			$.ajax({
				type : 'POST',
				url : "/api/testEntity/create", 
				data : $("#form-entity").serialize()})
			.done(function(item){
				//A partir de aquí se puede trabajar con la información como sea necesario
				$("#display-table").append(generateItemRow(item));
				$("#form-entity input[name=value]").val('');
			});
		}
		function getEntities()
		{
			//La siguiente petición nos regresa todas las entidades de prueba
			$.ajax({method: "GET", url: "/api/testEntity"})
			.done(function(msg){
				//A partir de aquí se puede trabajar con la información como sea necesario
				for_each(msg, function(item){
					$("#display-table").append(generateItemRow(item));
				});
			});
		}
		function getToken()
		{
			//Puedes obtener el valor del token con la siguiente ruta
			$.ajax({method: "GET", url: "/api/token"})
			.done(function(msg){
				$("#token").text(msg);
				//Le concatenamos el valor del token al atributo oculto del form,
				//esto nos permitira poder llevar a cabo la petición mediante el
				//método POST
				$("#formToken").attr("value", msg);
			});
		}
		function for_each(_array, _function)
		{
			for(i = 0; i < _array.length; i++){
				_function(_array[i]);
			}
		}
		function generateItemRow(item)
		{
			const value = "<td>"+ item.value +"</td>";
			const id = "<td>"+ item.id +"</td>";
			const tableRow = "<tr>"+ id + value +"</tr>";
			return tableRow;
		}
	</script>
</body>
</html>